import React from 'react'
import Link from 'next/link'
import { Phone } from 'lucide-react'
import { Button } from '../ui/button'
import { Tenant } from '@/lib/types'
import dynamic from 'next/dynamic'
import TenantSelect from './tenant-select'
import { getSession } from '@/lib/session'
import { logout } from '@/lib/actions/logout'
import LogoutButton from './logout'

const CartCounterWithoutSSR = dynamic(() => import('./cart-counter'), { ssr: false })

const Header = async () => {
    const session = await getSession()

    const tenantsResponse = await fetch(`${process.env.BACKEND_URL}/api/auth/tenants?perPage=100`, {
        next: {
            revalidate: 3600 // cache for 1 hour
        }
    })
    if (!tenantsResponse.ok) {
        throw new Error("Failed to fetch tenants")
    }
    const restaurants: { data: Tenant[] } = await tenantsResponse.json();

    return (
        <header className='bg-white'>
            <nav className='container py-5 mx-auto max-w-screen-lg flex items-center justify-between ' style={{ outline: "none" }}>
                <div className='flex items-center space-x-4'>
                    <svg width="148" height="23" viewBox="0 0 148 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M40.322 9.63C40.322 10.434 40.136 11.166 39.764 11.826C39.392 12.474 38.84 12.99 38.108 13.374C37.388 13.758 36.512 13.95 35.48 13.95H33.896V18H29.9V5.256H35.48C37.04 5.256 38.234 5.652 39.062 6.444C39.902 7.236 40.322 8.298 40.322 9.63ZM35.03 10.8C35.858 10.8 36.272 10.41 36.272 9.63C36.272 8.85 35.858 8.46 35.03 8.46H33.896V10.8H35.03ZM45.5855 5.256V18H41.5895V5.256H45.5855ZM51.8182 14.814H56.9302V18H47.3902V14.994L52.4302 8.424H47.3902V5.256H56.9302V8.262L51.8182 14.814ZM63.1561 14.814H68.2681V18H58.7281V14.994L63.7681 8.424H58.7281V5.256H68.2681V8.262L63.1561 14.814ZM78.238 16.074H73.99L73.36 18H69.166L73.828 5.256H78.436L83.08 18H78.868L78.238 16.074ZM77.266 13.068L76.114 9.522L74.962 13.068H77.266ZM98.8365 5.256V18H94.8405V13.032H91.0425V18H87.0465V5.256H91.0425V9.846H94.8405V5.256H98.8365ZM106.844 18.126C105.644 18.126 104.54 17.844 103.532 17.28C102.536 16.716 101.744 15.936 101.156 14.94C100.568 13.944 100.274 12.822 100.274 11.574C100.274 10.326 100.568 9.204 101.156 8.208C101.744 7.212 102.536 6.438 103.532 5.886C104.54 5.322 105.644 5.04 106.844 5.04C108.044 5.04 109.142 5.322 110.138 5.886C111.134 6.438 111.92 7.212 112.496 8.208C113.084 9.204 113.378 10.326 113.378 11.574C113.378 12.822 113.084 13.944 112.496 14.94C111.92 15.936 111.128 16.716 110.12 17.28C109.124 17.844 108.032 18.126 106.844 18.126ZM106.844 14.4C107.636 14.4 108.248 14.148 108.68 13.644C109.112 13.128 109.328 12.438 109.328 11.574C109.328 10.698 109.112 10.008 108.68 9.504C108.248 8.988 107.636 8.73 106.844 8.73C106.04 8.73 105.422 8.988 104.99 9.504C104.558 10.008 104.342 10.698 104.342 11.574C104.342 12.438 104.558 13.128 104.99 13.644C105.422 14.148 106.04 14.4 106.844 14.4ZM118.726 5.256V12.438C118.726 13.026 118.852 13.494 119.104 13.842C119.368 14.178 119.788 14.346 120.364 14.346C120.94 14.346 121.366 14.178 121.642 13.842C121.918 13.494 122.056 13.026 122.056 12.438V5.256H126.034V12.438C126.034 13.65 125.782 14.688 125.278 15.552C124.774 16.404 124.084 17.046 123.208 17.478C122.332 17.91 121.354 18.126 120.274 18.126C119.194 18.126 118.234 17.91 117.394 17.478C116.566 17.046 115.918 16.404 115.45 15.552C114.982 14.7 114.748 13.662 114.748 12.438V5.256H118.726ZM132.743 18.126C131.219 18.126 129.959 17.772 128.963 17.064C127.979 16.344 127.445 15.294 127.361 13.914H131.609C131.669 14.646 131.993 15.012 132.581 15.012C132.797 15.012 132.977 14.964 133.121 14.868C133.277 14.76 133.355 14.598 133.355 14.382C133.355 14.082 133.193 13.842 132.869 13.662C132.545 13.47 132.041 13.254 131.357 13.014C130.541 12.726 129.863 12.444 129.323 12.168C128.795 11.892 128.339 11.49 127.955 10.962C127.571 10.434 127.385 9.756 127.397 8.928C127.397 8.1 127.607 7.398 128.027 6.822C128.459 6.234 129.041 5.79 129.773 5.49C130.517 5.19 131.351 5.04 132.275 5.04C133.835 5.04 135.071 5.4 135.983 6.12C136.907 6.84 137.393 7.854 137.441 9.162H133.139C133.127 8.802 133.037 8.544 132.869 8.388C132.701 8.232 132.497 8.154 132.257 8.154C132.089 8.154 131.951 8.214 131.843 8.334C131.735 8.442 131.681 8.598 131.681 8.802C131.681 9.09 131.837 9.33 132.149 9.522C132.473 9.702 132.983 9.924 133.679 10.188C134.483 10.488 135.143 10.776 135.659 11.052C136.187 11.328 136.643 11.712 137.027 12.204C137.411 12.696 137.603 13.314 137.603 14.058C137.603 14.838 137.411 15.54 137.027 16.164C136.643 16.776 136.085 17.256 135.353 17.604C134.621 17.952 133.751 18.126 132.743 18.126ZM143.003 8.442V10.008H146.963V13.014H143.003V14.814H147.503V18H139.007V5.256H147.503V8.442H143.003Z" fill="#484848" />
                        <circle cx="11" cy="11" r="7.5" stroke="#F65F42" strokeWidth="7" />
                    </svg>
                    <TenantSelect restaurants={restaurants} />
                </div>
                <div className='flex items-center gap-x-4'>
                    <ul className='flex items-center font-medium space-x-4'>
                        <li className='hover:text-primary'><Link href={"/"}>Menu</Link></li>
                        <li className='hover:text-primary'><Link href={"/"}>Orders</Link></li>
                    </ul>
                    <CartCounterWithoutSSR />
                    <div className='flex items-center ml-12'>
                        <Phone />
                        <span>+91 9490 625 094</span>
                    </div>
                    {
                        session ? <LogoutButton /> : (<Button size={"sm"} asChild><Link href={"login"}>Login</Link></Button>)
                    }

                </div>
            </nav>
        </header>
    )
}

export default Header